scenarios:
  - name: Send_flowers_to_friends
    description: Send flowers to friends
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - click: [490, 600] # Skip Hero Upgrade Pack popup window
            - click: [60, 680] # Friends icon
            - click: [715, 670] # Send All
            - click: [635, 535] # Claim
            - click: [965, 670] # Receive All
            - click: [640, 505] # Claim
            - click: [60, 50] # return to the main  game screen
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Send_flowers_to_friends scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Send_flowers_to_friends scenario is skipped for the {{ instance_name }} instance and game was restarted." 
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Send_flowers_to_friends scenario is skipped for the {{ instance_name }} instance and game was not restarted." 
  
  - name: Daily_rewards
    description: Collect daily rewards
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                envelop_coords: "{{ get_coords_from_image('envelop.png') }}"
            
            - if:
                condition: "envelop_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Envelop coordinates found"
                  - click: "{{ envelop_coords }}" # Click on the Mail System icon
                  - delay: 2
                  - set:
                      mail_system_coords: "{{ get_coords_from_image('daily_rewards_system.png') }}"
                  - if:
                      condition: "mail_system_coords"  # This is true if coordinates were found, false if None
                      then:
                        - log: "Mail system coordinates found"
                        - click: "{{ mail_system_coords }}" # Click on the Mail System icon
                        - set:
                            mail_claim_all_coords: "{{ get_coords_from_image('Claim_all.png') }}"
                        - if:
                            condition: "mail_claim_all_coords"  # This is true if coordinates were found,
                            then:
                              - log: "Mail Claim All coordinates found"
                              - click: "{{mail_claim_all_coords}}" # Click on the Mail System icon
                              - set:
                                  claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "claim_button_coords"  # This is true if coordinates were found,
                                  then:
                                    - log: "Claim button coordinates found"
                                    - click: "{{claim_button_coords}}" # Click on the Claim button
                                    - delay: 1
                                    - click: [60, 50]  # return to the main  game screen
                            else:
                              - log: "Mail Claim All coordinates not found, returning to main game screen"
                              - click: [60, 50] # return to the main  game screen
                      else:
                        - log: "Mail system coordinates not found, returning to main game screen"
                        - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Envelop icon is not available, returning to main game screen"
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Daily_rewards scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Daily_rewards scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Daily_rewards scenario is skipped for the {{ instance_name }} instance and game was not restarted."
                  

  - name: Campaign_farming
    description: Campaign farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                campaign_coords: "{{ get_coords_from_image('Campaign.png') }}"
            - if:
                condition: "campaign_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Campaign coordinates found"
                  - click: [ "{{ campaign_coords[0] - 115 }}", "{{ campaign_coords[1]-60 }}" ] # Click on the Campaign icon
                  - delay: 2
                  - set:
                      campaign_claim_button_coords: "{{ get_coords_from_image('campaign_claim.png') }}"
                  - if:
                      condition: "campaign_claim_button_coords"  # This is true if coordinates were found,
                      then:
                        - log: "Campaign Claim button coordinates found"
                        - click: "{{campaign_claim_button_coords}}" # Click on the Campaign Claim button
                        - delay: 2
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                      else:
                        - log: "Campaign Claim button coordinates not found."
                  
                  - log: "Checking for Campaign Accelerate for free button"
                  - set:
                      campaign_accelerate_free_coords: "{{ get_coords_from_image('campaign_free_accelerate.png') }}" # TO-DO change to Free Accelerate
                  - if:
                      condition: "campaign_accelerate_free_coords"  # This is true if coordinates
                      then:
                        - log: "Campaign Accelerate for free coordinates found"
                        - click: "{{campaign_accelerate_free_coords}}" # Click on the Campaign Accelerate for 50 gems button
                        - delay: 5
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                  
                  - log: "Checking for Campaign Accelerate for 50 gems button"
                  - set:
                      campaign_accelerate_50_coords: "{{ get_coords_from_image('campaign_accelerate_50.png') }}"
                  - set:
                      campaign_accelerate_ticket_coords: "{{ get_coords_from_image('accelarate.png') }}"
                  - if:
                      condition: "campaign_accelerate_50_coords or campaign_accelerate_ticket_coords"  # This is true if coordinates
                      then:
                        - if:
                            condition: "campaign_accelerate_50_coords"
                            then:
                              - log: "Found 'Accelerate for 50 gems' button. Clicking it."
                              - click: "{{ campaign_accelerate_50_coords }}"
                            else:
                              - log: "Found 'Accelerate with Ticket' button. Clicking it."
                              - click: "{{ campaign_accelerate_ticket_coords }}"
                        - delay: 5
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                  
                  - click: [60, 50] # return to the main  game screen
                  - set:
                      team_coords: "{{ get_coords_from_image('campaign_team.png') }}"
                  - if:
                      condition: "team_coords"  # We are still inside campaign interface. need to go to the main screen
                      then:
                        - log: "Still in the Campaign. Return to the main game screen"
                        - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Campaign icon is not available"
                  - send_email: "Campaign farming failed for the {{ instance_name }} instance." # send an email if Campaign icon is not available
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Campaign_farming scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Campaign_farming scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Campaign_farming scenario is skipped for the {{ instance_name }} instance and game was not restarted."
  
  - name: Gene_Bank
    description: Gene Bank farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                gene_bank_coords: "{{ get_coords_from_image('GeneBank.png') }}"
            - if:
                condition: "gene_bank_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Gene Bank coordinates found"
                  - click: [ "{{ gene_bank_coords[0] - 115 }}", "{{ gene_bank_coords[1]-60 }}" ] # Click on the Gene Bank icon
                  - delay: 2
                  - log : "Checking if ordinary clone is available"
                  - set:
                      free_ordinary_coords: "{{ get_coords_from_image('Free_Ordinary_Clone.png') }}"
                  - if:
                      condition: "free_ordinary_coords"  # If Free Ordinary Clone button is available
                      then:
                        - log: "Free Ordinary Clone button coordinates found"
                        - click: "{{free_ordinary_coords}}" # Click on the Free Ordinary Clone button
                        - delay: 3
                        - set:
                            cancel_button_coords: "{{ get_coords_from_image('gene_bank_cancel.png') }}"
                        - if:
                            condition: "cancel_button_coords"  # If Confirm button is available
                            then:
                              - log: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full"
                              - send_email: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full" # send an email if capacity is full
                              - click: "{{cancel_button_coords}}" # Click on the Confirm button
                              - click: [60, 50] # return to the main  game screen
                            else:
                              - click: [60, 50] # return to the gene bank screen
                              
                      else:
                        - log: "Free Ordinary Clone button not found"
                        #- log: "Free Ordinary Clone button not found, checking for Free Advanced Clone button"
                  
                  - log : "Checking if Advanced clone is available"
                  - set:
                      free_advanced_coords: "{{ get_coords_from_image('Free_Advanced_Clone.png') }}"
                  - if:
                      condition: "free_advanced_coords"  # If Free Advanced Clone button is available
                      then:
                        - log: "Free Advanced Clone button coordinates found"
                        - click: "{{free_advanced_coords}}" # Click on the Free Advanced Clone button
                        - delay: 3
                        - set:
                            cancel_button_coords: "{{ get_coords_from_image('gene_bank_cancel.png') }}"
                        - if:
                            condition: "cancel_button_coords"  # If Confirm button is available
                            then:
                              - log: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full"
                              - send_email: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full" # send an email if capacity is full
                              - click: "{{cancel_button_coords}}" # Click on the Confirm button
                              - click: [60, 50] # return to the gene bank screen
                            else:
                              - click: [60, 50] # return to the gene bank screen
                              
                      else:
                        - log: "Free Advanced Clone button not found"
                        #- log: "Free Ordinary Clone button not found, checking for Free Advanced Clone button"

                  - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Gene Bank icon is not available"
                  - send_email: "Gene Bank farming failed for the {{ instance_name }} instance. Gene Bank icon is not available" 
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Gene_Bank scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Gene_Bank scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Gene_Bank scenario is skipped for the {{ instance_name }} instance and game was not restarted."
                  
                        
  - name: Guild_activity
    description: Guild activity
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - log: "Guild coordinates found"
            - click: "{{guild_coords}}" # Click on the Guild icon
            - delay: 3
            - log : "Check if Boss reward is available"
            - set:
                boss_reward_coords: "{{ get_coords_from_image('Boss_reward_claim.png') }}"
            - if:
                condition: "boss_reward_coords"  # Check if Boss reward is available
                then:
                  - click: "{{boss_reward_coords}}" # Claim Boss reward
                  - delay: 2
                  - set:
                      boss_reward_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                  - click: "{{boss_reward_coords}}" # Claim Boss reward
                  - click: [60,50] # exit from the Boss reward screen
                else:
                  - log: "Boss reward not available"

            - log : "Check if Claim_playoff_round_reward is available"
            - set:
                playoff_round_reward_coords: "{{ get_coords_from_image('Claim_playoff_round_reward.png') }}" # TO-DO change to real image. The current is fake
            - if:
                condition: "playoff_round_reward_coords" # Claim_playoff_round_reward 
                then:
                  - click: [ "{{ playoff_round_reward_coords[0] + 170 }}", "{{ playoff_round_reward_coords[1] }}" ] # click Claim button
                  - delay: 1
                  - set:
                      playoff_round_claim_button_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}" 
                  - if:
                      condition: "playoff_round_claim_button_coords" # Claim another Claim button
                      then:
                        - click: "{{playoff_round_claim_button_coords}}" # click another Claim button
                        - delay: 1
                        - click: [60, 50] # exit from the playoff round reward screen
                      else:
                        - log: "Playoff round clain button is not available" 
                else:
                  - log: "Playoff round reward not available"
            
            - log : "Check if champion league final reward is available"
            - set:
                championship_reward_coords: "{{ get_coords_from_image('champion_cup_reward.png') }}"
            - if:
                condition: "championship_reward_coords" # Claim championship reward
                then:
                  - log: "Championship reward coordinates found"
                  - click: [ "{{ championship_reward_coords[0]}}", "{{ championship_reward_coords[1] }}" ] # Claim Championship reward
                  - delay: 3
                  - set:
                      claim_button_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}" 
                  - if:
                      condition: "claim_button_coords" # Claim another Claim button
                      then:
                        - click: "{{claim_button_coords}}" # click another Claim button
                        - delay: 1
                        - click: [60, 50] # exit from the playoff round reward screen
                      else:
                        - log: " clain button is not available" 
                else:
                  - log: "Champion league final reward is not available"
            
            - log : "Daily Sign In"
            - set:
                sign_in_coords: "{{ get_coords_from_image('sign_in.png') }}"
            - if:
                condition: "sign_in_coords" # Check if Sign-in button is available
                then:
                  - click: "{{sign_in_coords}}" # click sign in
                  - delay: 2
                  - set:
                      sign_in_claim_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}"
                  - if:
                      condition: "sign_in_claim_coords" # Check if Claim button is available
                      then:
                        - click: "{{sign_in_claim_coords}}" # click Claim
                      else:
                        - log: "Sign-in claim button not found, returning to the guild screen"
                else:
                  - log: "Sign-in button has already been clicked"
            
            - log : "Go to Boss war screen"
            - set:
                boss_war_coords: "{{ get_coords_from_image('war_will_end.png') }}"
            - if:
                condition: "boss_war_coords" # Go to Boss war screen
                then:
                  - click: "{{boss_war_coords}}" # Go to Boss war screen
                  - delay: 2
                  - log: "Check if Challenge button available"
                  - set:
                      challenge_button_coords: "{{ get_coords_from_image('Challenge.png') }}" #TO-DO replace to a normal  war challenge button
                  - if:
                      condition: "challenge_button_coords" # Check if Challenge button available
                      then:
                        - click: "{{challenge_button_coords}}" # click Challenge button
                        - delay: 2
                        - set:
                            start_button_coords: "{{ get_coords_from_image('boss_war_start.png') }}"
                        - if:
                            condition: "start_button_coords" # Check if Start button is available
                            then:
                              - click: "{{start_button_coords}}" # click Start button
                              - delay: 5
                              - set:
                                  click_attempts: 0
                              - set:
                                  boss_war_reward_claim_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                              - while:
                                  condition: "not boss_war_reward_claim_coords and click_attempts < 10" 
                                  do:
                                    - log: "Claim button not visible. Attempt #{{ click_attempts + 1 }}"
                                    - set:
                                        end_boss_battle_button_coords: "{{ get_coords_from_image('end_boss_battle.png') }}"
                                    - if:
                                        condition: "end_boss_battle_button_coords"  # If End Boss Battle button is available
                                        then:
                                          - click: "{{end_boss_battle_button_coords}}" # click on fight finish button until Claim button appears
                                          - delay: 2
                                        else:
                                          - log: "WARNING: Neither 'Claim' nor 'End Battle' button is visible. Waiting..."
                                          - delay: 2
                                    - increment: click_attempts
                                    - set:
                                        boss_war_reward_claim_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                              
                              - if:
                                  condition: "boss_war_reward_claim_coords"
                                  then:
                                    - log: "Success! Claim button is now visible. Clicking it."
                                    - click: "{{ boss_war_reward_claim_coords }}"
                                    - set:
                                        confirm_button_coords: "{{ get_coords_from_image('confirm.png') }}"
                                    - click: "{{confirm_button_coords}}" # click Confirm button to finish the boss  battle
                                    - delay: 2
                                    - click: [60, 50] # unfocus from the ship
                                    - click: [60, 50] # return to the guild menu
                                  else:
                                    # This block runs if the loop finished because it hit 10 attempts.
                                    - log: "ERROR: Claim button did not appear after 10 attempts."
                                    - send_email: "[ERROR] Boss War: Failed to find reward claim button after 10 attempts. Exit the program to avoid indefinine loop" # send an email if Claim button is not available
                                    - emergency_exit: "Boss War: Failed to find reward claim button after 10 attempts."
                            else:
                              - log: "Start  button not available, returning to the guild screen"
                              - click: [60, 50] # unfocus from the ship
                              - click: [60, 50] # unfocus from the ship
                              - click: [60, 50] # return to the guild menu
                      else:
                        - log: "Challenge button not available, returning to the guild screen"
                        - click: [60, 50] # unfocus from the ship
                        - click: [60, 50] # return to the guild menu  
                else:
                  - log: "Boss war screen not available"
                  
            - click: [60, 50] # return to the main game menu
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Guild_activity_new scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Guild_activity scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Guild_activity scenario is skipped for the {{ instance_name }} instance and game was not restarted."
                  
  
  - name: Airship_farming
    description: Airship farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [996,352, left,400] # Scroll right to make sure Airship icon is visible
            - set:
                Airship_coords: "{{ get_coords_from_image('Airship.png') }}"
            - if:
                condition: "Airship_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Airship coordinates found"
                  - click: [ "{{ Airship_coords[0]}}", "{{ Airship_coords[1]-100 }}" ] # Click on the Airship icon
                  - delay: 2
                  - log : "Checking if Dragon_Crusade is on the screen"
                  - set:
                      Dragon_Crusade_coords: "{{ get_coords_from_image('Dragon_Crusade.png') }}"
                  - if:
                      condition: "Dragon_Crusade_coords"  # If Airship farming is available
                      then:
                        - log: "Dragon_Crusade_coords  coordinates found"
                        - click: [ "{{ Dragon_Crusade_coords[0]}}", "{{ Dragon_Crusade_coords[1]+200 }}" ] # Click on the Dragon_Crusade icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Dragon_Crusade icon is not available. I'm trying to click next one."
                        - click: [60, 50] # exit from the Airship reward screen
                  - set:
                      Steampunk_Relic_coords: "{{ get_coords_from_image('Steampunk_Relic.png') }}"
                  - if:
                      condition: "Steampunk_Relic_coords"  # If Steampunk_Relic_coords is available
                      then:
                        - log: "Steampunk_Relic_coords  coordinates found"
                        - click: [ "{{ Steampunk_Relic_coords[0]}}", "{{ Steampunk_Relic_coords[1]+200 }}" ] # Click on the Steampunk_Relic icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up 
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              # - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Steampunk_Relic icon is not available. I'm trying to click next one."
                        - click: [60, 50] # exit from the Airship reward screen
                  - set:
                      Mine_Exploration_coords: "{{ get_coords_from_image('Mine_Exploration.png') }}"
                  - if:
                      condition: "Mine_Exploration_coords"  # If Airship farming is available
                      then:
                        - log: "Mine_Exploration_coords  coordinates found"
                        - click: [ "{{ Mine_Exploration_coords[0]}}", "{{ Mine_Exploration_coords[1]+200 }}" ] # Click on the Mine_Exploration icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up 
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              # - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Mine_Exploration icon is not available. Finishing Airship farming."
                        - click: [60, 50] # exit from the Airship reward screen
            
                  - log: "Try to exit from the Airship farming screen"
                  - click: [60, 50] # return to the main game screen
                  - set:
                      Mine_Exploration_coords: "{{ get_coords_from_image('Mine_Exploration.png') }}"
                  - log : "Checking if Mine_Exploration icon is available"
                  - if:
                      condition: "Mine_Exploration_coords"  # This is true if coordinates were found, false
                      then:                  
                        - log: "Mine_Exploration_coords icon is available, return to the main game screen"
                        - click: [60, 50] # return to the main game screen
                      else:
                        - log: "It seems we are in the main game screen already, no need to click"
                else:
                  - log: "Airship farming is not available. The resources might be colelcted already. Returning to the main game screen"
                  # - send_email: "Airship farming failed for the {{ instance_name }} instance. Airship icon is not available" # send an email if Airship icon is not available
                  
            - log : "End of Airship farming"
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Airship_farming scenario is skipped due to game unavailability and restarted."
                  - send_email: "Airship_farming scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Airship_farming scenario is skipped for the {{ instance_name }} instance and game was not restarted."
                  

  - name: Dangeon_farming
    description: Dangeon farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [996,352, left,400] # Scroll left to make sure Dangeon icon is visible
            - set:
                Dangeon_coords: "{{ get_coords_from_image('dangeon.png') }}"
            - if:
                condition: "Dangeon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Dangeon coordinates found"
                  - click: [ "{{ Dangeon_coords[0]}}", "{{ Dangeon_coords[1]-150 }}" ] # Click on the Dangeon icon
                  - delay: 3
                  - log : "Checking if Sweep farming is available"
                  - set:
                      Sweep_button_coords: "{{ get_coords_from_image('Sweep_purple.png') }}"
                  - if:
                      condition: "Sweep_button_coords"  # If Dangeon farming is available
                      then:
                        - log: "Sweep_button_coords coordinates found"
                        - click: "{{ Sweep_button_coords }}" # Click on the Sweep button
                        - delay: 2
                        - set:
                            confirm_button_coords: "{{ get_coords_from_image('confirm_purple.png') }}"
                        - if:
                            condition: "confirm_button_coords"  # If Confirm button is available
                            then:
                              - log: "Confirm button coordinates found"
                              - click: "{{ confirm_button_coords }}" # Click on the Confirm button
                              - delay: 2
                              - set:
                                  claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "claim_button_coords"  # If Claim button is available
                                  then:
                                    - log: "Claim button coordinates found"
                                    - click: "{{ claim_button_coords }}" # Click on the Claim button
                                    - delay: 2
                                    - set:
                                        advanced_button_coords: "{{ get_coords_from_image('advanced.png') }}"
                                    - if:
                                        condition: "advanced_button_coords"  # If Confirm button is available
                                        then:
                                          - click: "{{ advanced_button_coords }}" # Click on the Confirm button
                                          - delay: 2
                                          - set:
                                              battle_red_coords: "{{ get_coords_from_image('battle_red.png') }}"
                                          - if:
                                              condition: "battle_red_coords"  # If Golden Chest button is available
                                              then:
                                                - log: "Battle Red button coordinates found"
                                                - click: [ "{{ battle_red_coords[0] + 865 }}", "{{ battle_red_coords[1]-15 }}" ] # Click on the Campaign icon
                                                - delay: 4
                                                - set:
                                                    claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                                                - if:
                                                    condition: "claim_button_coords"  # If Claim button is available
                                                    then:
                                                      - click: "{{ claim_button_coords }}" # Click on the Claim button
                                                      #- click: [60, 50] # exit from the Dangeon farming screen
                                                    else:
                                                      - log: "Claim button is not available in Dangeon farming"
                                                      #- click: [60, 50] # exit from the Dangeon farming screen
                                              else:
                                                - log: "Golden Chest button is not available in Dangeon farming"
                            else:
                              - log: "Confirm button is not available in Dangeon farming"
                      else:
                        - log: "Sweep button is not available"
                  - click: [60, 50] # return to the main game screen
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Airship_farming scenario is skipped due to game unavailability and restarted."
                  - send_email: "Dangeon_farming scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Dangeon_farming scenario is skipped for the {{ instance_name }} instance and game was not restarted."
                  

  - name: Arena_farming
    description: Arena farming. Fight the most left opponent in the list. Good for minor accounts.
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - log: "Guild coordinates found"
            - set:
                arena_icon_coords: "{{ get_coords_from_image('Arena.png') }}"
            - if:
                condition: "arena_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "arena facility coordinates found"
                  - click: [ "{{ arena_icon_coords[0] }}", "{{ arena_icon_coords[1]-100 }}" ] # Click on the Arena icon
                  - delay: 1
                  - log : "Checking if General Arena farming is available"
                  - set:
                      general_arena_icon_coords: "{{ get_coords_from_image('general_arena.png') }}"
                  - if:
                      condition: "general_arena_icon_coords"  # If General Arena farming is available
                      then:
                      ###
                        - log: "General Arena icon coordinates found. Go to General Arena"
                        - click: [ "{{ general_arena_icon_coords[0] }}", "{{ general_arena_icon_coords[1]+200 }}" ]
                        - delay: 3
                        - set:
                            match_button_coords: "{{ get_coords_from_image('match_yellow.png') }}"
                        - if:
                            condition: "match_button_coords"  # If Match button is available
                            then:
                              - click: "{{ match_button_coords }}" # Click on the Match button
                              - delay: 2
                              - log: "Match button coordinates found. Starting 3 attack loops."
                              
                              # 1. Initialize the loop counter
                              - set:
                                  attack_counter: 0
                                  
                              # 2. Start the while loop, which will run as long as the counter is less than 3
                              - while:
                                  condition: "attack_counter < 3"
                                  do:
                                    - log: "--- Starting General Arena Attack #{{ attack_counter + 1 }} ---"
                                    
                                    # 3. This is your entire "Attack" block, which will now be repeated
                                    - set:
                                        free_battle_coords: "{{ get_all_coords_from_image('free_battle.png') }}"
                                    - if:
                                        condition: "free_battle_coords"  # If free battle checkbox is available
                                        then:
                                          - log: "Free battle checkbox found."
                                          - click: "{{ free_battle_coords[0] }}" # Click on the left Free button 
                                          - delay: 2
                                          - click: [ "{{ free_battle_coords[0][0] + 200 }}", "{{ free_battle_coords[0][1] }}" ] # Click the 'Battle' button
                                          - delay: 2
                                          - log: "Confirming battle result (e.g., league increase)."
                                          - click: [ "{{ free_battle_coords[0][0] + 200 }}", "{{ free_battle_coords[0][1] }}" ] # Click the 'Confirm' button
                                          - delay: 2 # Wait for the arena screen to be ready for the next attack
                                        else:
                                          - log: "Free battle button is not available for this attack. Continuing without it."
                                    
                                    # 4. CRUCIAL: Increment the counter at the end of each loop
                                    - increment: attack_counter
                                    
                              # 5. This part runs AFTER the while loop is finished
                              - log: "All 3 arena attacks completed. Exiting."
                              - click: [60, 50] # exit General arena screen
                              - delay: 2
                              - click: [60, 50] # exit General arena screen
                            else:
                              - log: "Match button is not available, returning to the guild screen."
                              - click: [60, 50] # exit General arena screen

                              ####
                      else:
                        - log: "General Arena icon is not available, continuing without it"
                        - send_email: "General Arena farming failed for the {{ instance_name }} instance. General Arena icon is not available" # send an email if General Arena icon is not available
                        #- click: [60, 50] # exit General arena screen

                  - log: "General Arena farming completed"
                  
                  - log : "Checking if Cross server Arena farming is available"
                  - set:
                      cross_server_arena_icon_coords: "{{ get_coords_from_image('cross_server_arena.png') }}"
                  - if:
                      condition: "cross_server_arena_icon_coords"  # If cross_server Arena farming is available
                      then:
                      ###
                        - log: "cross server Arena icon coordinates found. Go to Cross Server Arena"
                        - click: [ "{{ cross_server_arena_icon_coords[0] }}", "{{ cross_server_arena_icon_coords[1]+200 }}" ]
                        - delay: 3
                        - set:
                            match_button_coords: "{{ get_coords_from_image('cross_server_matching.png') }}"
                        - if:
                            condition: "match_button_coords"  # If Match button is available
                            then:
                              - click: "{{ match_button_coords }}" # Click on the Match button
                              - delay: 2
                              - log: "Match button coordinates found. Starting 3 attack loops."
                              
                              # 1. Initialize the loop counter
                              - set:
                                  attack_counter: 0
                                  
                              # 2. Start the while loop, which will run as long as the counter is less than 3
                              - while:
                                  condition: "attack_counter < 3"
                                  do:
                                    - log: "--- Starting Cross Server Arena Attack #{{ attack_counter + 1 }} ---"
                                    
                                    # 3. This is your entire "Attack" block, which will now be repeated
                                    - set:
                                        free_battle_coords: "{{ get_all_coords_from_image('free_battle.png') }}"
                                    - if:
                                        condition: "free_battle_coords"  # If free battle checkbox is available
                                        then:
                                          - log: "Free battle checkbox found."
                                          - click: "{{ free_battle_coords[0] }}" # Click on the left Free button 
                                          - delay: 2
                                          - click: [ "{{ free_battle_coords[0][0] + 200 }}", "{{ free_battle_coords[0][1] }}" ] # Click the 'Battle' button
                                          - delay: 2
                                          - log: "Confirming battle result (e.g., league increase)."
                                          - click: [ "{{ free_battle_coords[0][0] + 200 }}", "{{ free_battle_coords[0][1] }}" ] # Click the 'Confirm' button
                                          - delay: 2 # Wait for the arena screen to be ready for the next attack
                                        else:
                                          - log: "Free battle button is not available for this attack. Continuing without it."
                                    
                                    # 4. CRUCIAL: Increment the counter at the end of each loop
                                    - increment: attack_counter
                                    
                              # 5. This part runs AFTER the while loop is finished
                              - log: "All 3 arena attacks completed. Exiting."
                              - click: [60, 50] # exit General arena screen
                              - delay: 2
                              - click: [60, 50] # exit General arena screen
                            else:
                              - log: "Match button is not available, returning to the guild screen."
                              - click: [60, 50] # exit General arena screen

                          ###
                      else:
                        - log: "Cross server Arena icon is not available, continuing without it"
                        - send_email: "Cross server Arena farming failed for the {{ instance_name }} instance. Cross server Arena icon is not available" # send an email if Cross server Arena icon is not available
                        #- click: [60, 50] # exit cross server arena screen
                  - log: "Cross server Arena farming completed"
                  
                  - log : "Checking if Summit Arena Challenge farming is available"
                  - set:
                      summit_arena_icon_coords: "{{ get_coords_from_image('summit_arena.png') }}"
                  - if:
                      condition: "summit_arena_icon_coords"  # If Summit Arena Challenge farming is available
                      then:
                        - log: "Summit Arena Challenge icon coordinates found. Go to Summit Arena Challenge"
                        - click: [ "{{ summit_arena_icon_coords[0] }}", "{{ summit_arena_icon_coords[1]+200 }}" ]
                        - delay: 3
                        - set:
                            match_button_coords: "{{ get_coords_from_image('cross_server_matching.png') }}"
                        - if:
                            condition: "match_button_coords"  # If Match button is available
                            then:
                              - click: "{{ match_button_coords }}" # Click on the Match button
                              - delay: 2
                              - log: "Match button coordinates found. Starting 3 attack loops."
                              
                              # 1. Initialize the loop counter
                              - set:
                                  attack_counter: 0
                                  
                              # 2. Start the while loop, which will run as long as the counter is less than 3
                              - while:
                                  condition: "attack_counter < 5"
                                  do:
                                    - log: "--- Starting Summit Arena Challenge Attack #{{ attack_counter + 1 }} ---"
                                    
                                    # 3. This is your entire "Attack" block, which will now be repeated
                                    - set:
                                        summit_battle_coords: "{{ get_all_coords_from_image('summit_arena_battle.png') }}"
                                    - if:
                                        condition: "summit_battle_coords"  # If free battle checkbox is available
                                        then:
                                          - log: "summit_battle_coords icon found."
                                          - click: "{{ summit_battle_coords[0] }}" # Click on the left Free button 
                                          - delay: 2
                                          - click: [ "{{ summit_battle_coords[0][0] + 200 }}", "{{ summit_battle_coords[0][1] }}" ] # Click the 'Battle' button
                                          - delay: 2
                                          - log: "Confirming battle result (e.g., league increase)."
                                          - click: [ "{{ summit_battle_coords[0][0] + 200 }}", "{{ summit_battle_coords[0][1] }}" ] # Click the 'Confirm' button
                                          - delay: 2 # Wait for the arena screen to be ready for the next attack
                                        else:
                                          - log: "summit_battle_coords battle button is not available for this attack. Continuing without it."
                                    
                                    # 4. CRUCIAL: Increment the counter at the end of each loop
                                    - increment: attack_counter
                              
                              # 5. This part runs AFTER the while loop is finished
                              - log: "All 5 arena attacks completed. Exiting."
                              - click: [60, 50] # exit Summit arena screen
                              - log: "make a 3 sec pause"
                              - delay: 3
                              - click: [60, 50] # exit Summit arena screen
                            else:
                              - log: "Match button is not available, returning to the guild screen."
                              - send_email: "Summit Arena Challenge farming failed for the {{ instance_name }} instance. Match button is not available" # send an email if Match button is not available
                              - click: [60, 50] # exit Summit arena screen

                          ###
                      else:
                        - log: "Summit Arena icon is not available, continuing without it"
                        - send_email: "Summit Arena Challenge farming failed for the {{ instance_name }} instance. Summit Arena icon is not available" # send an email if Summit Arena icon is not available
                        #- click: [60, 50] # exit cross server arena screen
                  - log: "Summit Arena farming completed. Exit to main game screen"
                  - click: [60, 50] # exit cross server arena screen
                else:
                  - log: "arena icon is not available, continuing without it"
                  - send_email: "Arena icon is not available for the {{ instance_name }} instance and farming is skipped." # send an email if Game icon is not available
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Arena_farming scenario is skipped due to game unavailability and restarted."
                  - send_email: "Arena_farming scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Arena_farming scenario is skipped for the {{ instance_name }} instance and game was not restarted."
      
  - name: Expedition1_farming
    description: Expedition1 farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [150,400, right,400] # Scroll left to make sure Expedition icon is visible
            - scroll: [150,400, right,400] # Scroll left to make sure Expedition icon is visible
            - scroll: [150,400, right,400] # Scroll left to make sure Expedition icon is visible
            - scroll: [150,400, right,400] # Scroll left to make sure Expedition icon is visible
            - set:
                expedition_icon_coords: "{{ get_coords_from_image('expedition.png') }}"
            - if:
                condition: "expedition_icon_coords"  # This is true if coordinates were found
                then:
                  - log: "Expedition icon coordinates found"
                  - click: [ "{{ expedition_icon_coords[0]}}", "{{ expedition_icon_coords[1]-100 }}" ] # Click on the Expedition icon
                  - delay: 3
                  - log : "Checking if Expedition 1 farming is available"
                  - set:
                      expedition1_icon_coords: "{{ get_coords_from_image('remote_road.png') }}"
                  - if:
                      condition: "expedition1_icon_coords"  # If Expedition1 farming is available
                      then:
                        - log: "Expedition1 icon coordinates found"
                        - click: [ "{{ expedition1_icon_coords[0]}}", "{{ expedition1_icon_coords[1]+200 }}" ] # Click on the Expedition1 icon
                        - delay: 3
                        - set:
                            free_refresh_button_coords: "{{ get_coords_from_image('free_refresh.png') }}"
                        - if:
                            condition: "free_refresh_button_coords"  # If free_refresh button is available
                            then:
                              - log: "free_refresh button coordinates found"
                              - click: "{{ free_refresh_button_coords }}" # Click on the free_refresh button
                              - delay: 3
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('confirm_purple.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{ confirm_button_coords }}" # Click on the Confirm button
                                    - delay: 2
                                    - set:
                                        expedition_coin_coords: "{{ get_coords_from_image('expedition_coin.png') }}" # expedition coin coordinates on the top
                                    - set:
                                        expedition_points_data:
                                          - { name: "Point 1", click: [ "{{ expedition_coin_coords[0]}}",    "{{ expedition_coin_coords[1]+200 }}" ], chest: [ "{{ expedition_coin_coords[0]+110}}", "{{ expedition_coin_coords[1]+200 }}" ] }
                                          - { name: "Point 2", click: [ "{{ expedition_coin_coords[0]+290}}", "{{ expedition_coin_coords[1]+430 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+410 }}" ] }
                                          - { name: "Point 3", click: [ "{{ expedition_coin_coords[0]+410}}", "{{ expedition_coin_coords[1]+165 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+215 }}" ] }
                                          - { name: "Point 4", click: [ "{{ expedition_coin_coords[0]+415}}", "{{ expedition_coin_coords[1]+490 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+415 }}" ] }
                                          - { name: "Point 5", click: [ "{{ expedition_coin_coords[0]+480}}", "{{ expedition_coin_coords[1]+190 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+175 }}" ] }
                                          - { name: "Point 6", click: [ "{{ expedition_coin_coords[0]+570}}", "{{ expedition_coin_coords[1]+320 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+255 }}" ] }
                                          - { name: "Point 7", click: [ "{{ expedition_coin_coords[0]+360}}", "{{ expedition_coin_coords[1]+105 }}" ], chest: [ "{{ expedition_coin_coords[0]+300}}", "{{ expedition_coin_coords[1]+90 }}" ] }
                                          - { name: "Point 8", click: [ "{{ expedition_coin_coords[0]+460}}", "{{ expedition_coin_coords[1]+175 }}" ], chest: [ "{{ expedition_coin_coords[0]+435}}", "{{ expedition_coin_coords[1]+140 }}" ] }
                                          - { name: "Point 9", click: [ "{{ expedition_coin_coords[0]+630}}", "{{ expedition_coin_coords[1]+330 }}" ], chest: [ "{{ expedition_coin_coords[0]+735}}", "{{ expedition_coin_coords[1]+380 }}" ] }
                                    - set:
                                        expedition_counter: 0
                                    - while:
                                        condition: "expedition_counter < len(expedition_points_data)"
                                        do:
                                          # Get the data for the current point
                                          - set:
                                              current_point: "{{ expedition_points_data[expedition_counter] }}"
                                          - log: "--- Starting Expedition {{ current_point.name }} ---"

                                          - click: "{{ current_point.click }}"
                                          - delay: 3
                                          - set:
                                              start_button_coords: "{{ get_coords_from_image('start_red.png') }}"
                                          - if:
                                              condition: "start_button_coords"
                                              then:
                                                - click: "{{ start_button_coords }}"
                                                - delay: 3
                                                - set:
                                                    confirm_button_coords: "{{ get_coords_from_image('confirm.png') }}"
                                                - if:
                                                    condition: "confirm_button_coords"
                                                    then:
                                                      - click: "{{ confirm_button_coords }}"
                                                      - delay: 3
                                                      # Use the 'chest' coordinates from our data
                                                      - click: "{{ current_point.chest }}"
                                                      - delay: 3
                                                      - set:
                                                          claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                                                      - if:
                                                          condition: "claim_button_coords"
                                                          then:
                                                            - click: "{{ claim_button_coords }}"
                                                            - delay: 3
                                                          else:
                                                            - log: "WARNING: Claim button not found for {{ current_point.name }}."
                                                    else:
                                                      - log: "WARNING: Inner Confirm button not found for {{ current_point.name }}."
                                              else:
                                                - log: "WARNING: Start button not found for {{ current_point.name }}."

                                          # 5. INCREMENT THE COUNTER TO MOVE TO THE NEXT POINT
                                          - increment: expedition_counter
                                  else:
                                    - log: "Confirm button is not available, continuing without it"
                            else:
                              - log: "Expedition1 free refresh button is not available, continuing without it"
                      else: 
                        - log: "Expedition1 icon is not available, continuing without it"
                  - click: [60, 50] # exit Expedition screen
                else:
                  - log: "Expedition1 icon is not available, continuing without it"
                                                            
                                                            
                
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Expedition1_farming scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Expedition1_farming scenario is skipped for the {{ instance_name }} instance and game was restarted." 
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Expedition1_farming scenario is skipped for the {{ instance_name }} instance and game was not restarted." 

  - name: Training_Center
    description: Training Center
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - log: "Guild coordinates found"
            - set:
                training_center_icon_coords: "{{ get_coords_from_image('training_center.png') }}"
            - if:
                condition: "training_center_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Training Center icon coordinates found"
                  - click: [ "{{ training_center_icon_coords[0]+40 }}", "{{ training_center_icon_coords[1]-115 }}" ] # Click on the Training Center icon
                  - delay: 5
                  - set:
                      arrow_right_coords: "{{ get_coords_from_image('arrow_right.png') }}"
                  - if:
                      condition: "arrow_right_coords"  # If Train button is available
                      then:
                        - log: "arrow_right_coords coordinates found"
                        - click: "{{ train_button_coords }}" # Click on the right arrow
                        - click: "{{ train_button_coords }}" # Click on the right arrow
                        ### stoppped here
                        - click: [ "{{ training_center_icon_coords[0]+40 }}", "{{ training_center_icon_coords[1]-115 }}" ] # Click on the Train button
                        - set:
                            confirm_button_coords: "{{ get_coords_from_image('confirm_purple.png') }}"
                        - if:
                            condition: "confirm_button_coords"  # If Confirm button is available
                            then:
                              - log: "Confirm button coordinates found"
                              - click: "{{ confirm_button_coords }}" # Click on the Confirm button
                              - delay: 2
                              - click: [60, 50] # exit Training Center screen
                            else:
                              - log: "Confirm button is not available in Training Center farming"
                      else:
                        - log: "Train button is not available in Training Center farming"
                else:
                  - log: "Training Center icon is not available, continuing without it"
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Training_Center scenario is skipped due to game unavailability and restarted."
                  - send_email: "[ERROR] Training_Center scenario is skipped for the {{ instance_name }} instance and game was restarted."
                else: 
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "[ERROR] Training_Center scenario is skipped for the {{ instance_name }} instance and game was not restarted."
