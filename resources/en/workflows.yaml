scenarios:
  - name: Send_flowers_to_friends
    description: Send flowers to friends
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - click: [490, 600] # Skip Hero Upgrade Pack popup window
            - click: [60, 680] # Friends icon
            - click: [715, 670] # Send All
            - click: [635, 535] # Claim
            - click: [965, 670] # Receive All
            - click: [640, 505] # Claim
            - click: [60, 50] # return to the main  game screen
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Send_flowers_to_friends scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available
  
  - name: Daily_rewards
    description: Collect daily rewards
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                envelop_coords: "{{ get_coords_from_image('envelop.png') }}"
            
            - if:
                condition: "envelop_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Envelop coordinates found"
                  - click: "{{ envelop_coords }}" # Click on the Mail System icon
                  - delay: 2
                  - set:
                      mail_system_coords: "{{ get_coords_from_image('daily_rewards_system.png') }}"
                  - if:
                      condition: "mail_system_coords"  # This is true if coordinates were found, false if None
                      then:
                        - log: "Mail system coordinates found"
                        - click: "{{ mail_system_coords }}" # Click on the Mail System icon
                        - set:
                            mail_claim_all_coords: "{{ get_coords_from_image('Claim_all.png') }}"
                        - if:
                            condition: "mail_claim_all_coords"  # This is true if coordinates were found,
                            then:
                              - log: "Mail Claim All coordinates found"
                              - click: "{{mail_claim_all_coords}}" # Click on the Mail System icon
                              - set:
                                  claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "claim_button_coords"  # This is true if coordinates were found,
                                  then:
                                    - log: "Claim button coordinates found"
                                    - click: "{{claim_button_coords}}" # Click on the Claim button
                                    - delay: 1
                                    - click: [60, 50]  # return to the main  game screen
                            else:
                              - log: "Mail Claim All coordinates not found, returning to main game screen"
                              - click: [60, 50] # return to the main  game screen
                      else:
                        - log: "Mail system coordinates not found, returning to main game screen"
                        - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Envelop icon is not available, returning to main game screen"
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Daily_rewards scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available

  - name: Campaign_farming
    description: Campaign farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                campaign_coords: "{{ get_coords_from_image('Campaign.png') }}"
            - if:
                condition: "campaign_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Campaign coordinates found"
                  - click: [ "{{ campaign_coords[0] - 115 }}", "{{ campaign_coords[1]-60 }}" ] # Click on the Campaign icon
                  - delay: 2
                  - set:
                      campaign_claim_button_coords: "{{ get_coords_from_image('campaign_claim.png') }}"
                  - if:
                      condition: "campaign_claim_button_coords"  # This is true if coordinates were found,
                      then:
                        - log: "Campaign Claim button coordinates found"
                        - click: "{{campaign_claim_button_coords}}" # Click on the Campaign Claim button
                        - delay: 2
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                      else:
                        - log: "Campaign Claim button coordinates not found."
                  
                  - log: "Checking for Campaign Accelerate for free button"
                  - set:
                      campaign_accelerate_free_coords: "{{ get_coords_from_image('campaign_free_accelerate.png') }}" # TO-DO change to Free Accelerate
                  - if:
                      condition: "campaign_accelerate_free_coords"  # This is true if coordinates
                      then:
                        - log: "Campaign Accelerate for free coordinates found"
                        - click: "{{campaign_accelerate_free_coords}}" # Click on the Campaign Accelerate for 50 gems button
                        - delay: 5
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                  
                  - log: "Checking for Campaign Accelerate for 50 gems button"
                  - set:
                      campaign_accelerate_50_coords: "{{ get_coords_from_image('campaign_accelerate_50.png') }}"
                  - set:
                      campaign_accelerate_ticket_coords: "{{ get_coords_from_image('accelarate.png') }}"
                  - if:
                      condition: "campaign_accelerate_50_coords or campaign_accelerate_ticket_coords"  # This is true if coordinates
                      then:
                        - if:
                            condition: "campaign_accelerate_50_coords"
                            then:
                              - log: "Found 'Accelerate for 50 gems' button. Clicking it."
                              - click: "{{ campaign_accelerate_50_coords }}"
                            else:
                              - log: "Found 'Accelerate with Ticket' button. Clicking it."
                              - click: "{{ campaign_accelerate_ticket_coords }}"
                        - delay: 5
                        - set:
                            level_up_coords: "{{ get_coords_from_image('please_tap_to_continue.png') }}"
                        - if:
                            condition: "level_up_coords" # If a new level is reached
                            then:
                              - log: "New level reached"
                              - click: "{{level_up_coords}}" # Click on 'Please tap to continue' message
                              - delay: 2
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                            else:
                              - log: "No new level reached, checking for Confirm button"
                              - set:
                                  confirm_button_coords: "{{ get_coords_from_image('campaign_confirm.png') }}"
                              - if:
                                  condition: "confirm_button_coords"  # If Confirm button is available
                                  then:
                                    - log: "Confirm button coordinates found"
                                    - click: "{{confirm_button_coords}}" # Click on the Confirm button
                  
                  - click: [60, 50] # return to the main  game screen
                  - set:
                      team_coords: "{{ get_coords_from_image('campaign_team.png') }}"
                  - if:
                      condition: "team_coords"  # We are still inside campaign interface. need to go to the main screen
                      then:
                        - log: "Still in the Campaign. Return to the main game screen"
                        - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Campaign icon is not available"
                  - send_email: "Campaign farming failed for the {{ instance_name }} instance." # send an email if Campaign icon is not available
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Campaign_farming scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available   
  
  - name: Gene_Bank
    description: Gene Bank farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - set:
                gene_bank_coords: "{{ get_coords_from_image('GeneBank.png') }}"
            - if:
                condition: "gene_bank_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Gene Bank coordinates found"
                  - click: [ "{{ gene_bank_coords[0] - 115 }}", "{{ gene_bank_coords[1]-60 }}" ] # Click on the Gene Bank icon
                  - delay: 2
                  - log : "Checking if ordinary clone is available"
                  - set:
                      free_ordinary_coords: "{{ get_coords_from_image('Free_Ordinary_Clone.png') }}"
                  - if:
                      condition: "free_ordinary_coords"  # If Free Ordinary Clone button is available
                      then:
                        - log: "Free Ordinary Clone button coordinates found"
                        - click: "{{free_ordinary_coords}}" # Click on the Free Ordinary Clone button
                        - delay: 3
                        - set:
                            cancel_button_coords: "{{ get_coords_from_image('gene_bank_cancel.png') }}"
                        - if:
                            condition: "cancel_button_coords"  # If Confirm button is available
                            then:
                              - log: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full"
                              - send_email: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full" # send an email if capacity is full
                              - click: "{{cancel_button_coords}}" # Click on the Confirm button
                              - click: [60, 50] # return to the main  game screen
                            else:
                              - click: [60, 50] # return to the gene bank screen
                              
                      else:
                        - log: "Free Ordinary Clone button not found"
                        #- log: "Free Ordinary Clone button not found, checking for Free Advanced Clone button"
                  
                  - log : "Checking if Advanced clone is available"
                  - set:
                      free_advanced_coords: "{{ get_coords_from_image('Free_Advanced_Clone.png') }}"
                  - if:
                      condition: "free_advanced_coords"  # If Free Advanced Clone button is available
                      then:
                        - log: "Free Advanced Clone button coordinates found"
                        - click: "{{free_advanced_coords}}" # Click on the Free Advanced Clone button
                        - delay: 3
                        - set:
                            cancel_button_coords: "{{ get_coords_from_image('gene_bank_cancel.png') }}"
                        - if:
                            condition: "cancel_button_coords"  # If Confirm button is available
                            then:
                              - log: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full"
                              - send_email: "The Gene Bank farming failed for the {{ instance_name }} instance. capacity is full" # send an email if capacity is full
                              - click: "{{cancel_button_coords}}" # Click on the Confirm button
                              - click: [60, 50] # return to the gene bank screen
                            else:
                              - click: [60, 50] # return to the gene bank screen
                              
                      else:
                        - log: "Free Advanced Clone button not found"
                        #- log: "Free Ordinary Clone button not found, checking for Free Advanced Clone button"

                  - click: [60, 50] # return to the main  game screen
                else:
                  - log: "Gene Bank icon is not available"
                  - send_email: "Gene Bank farming failed for the {{ instance_name }} instance. Gene Bank icon is not available" 
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Gene_Bank scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available
                        
  - name: Guild_activity
    description: Guild activity
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - log: "Guild coordinates found"
            - click: "{{guild_coords}}" # Click on the Guild icon
            - delay: 3
            - log : "Check if Boss reward is available"
            - set:
                boss_reward_coords: "{{ get_coords_from_image('Boss_reward_claim.png') }}"
            - if:
                condition: "boss_reward_coords"  # Check if Boss reward is available
                then:
                  - click: "{{boss_reward_coords}}" # Claim Boss reward
                  - delay: 2
                  - set:
                      boss_reward_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                  - click: "{{boss_reward_coords}}" # Claim Boss reward
                  - click: [60,50] # exit from the Boss reward screen
                else:
                  - log: "Boss reward not available"

            - log : "Check if Claim_playoff_round_reward is available"
            - set:
                playoff_round_reward_coords: "{{ get_coords_from_image('Claim_playoff_round_reward.png') }}" # TO-DO change to real image. The current is fake
            - if:
                condition: "playoff_round_reward_coords" # Claim_playoff_round_reward 
                then:
                  - click: [ "{{ playoff_round_reward_coords[0] + 170 }}", "{{ playoff_round_reward_coords[1] }}" ] # click Claim button
                  - delay: 1
                  - set:
                      playoff_round_claim_button_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}" 
                  - if:
                      condition: "playoff_round_claim_button_coords" # Claim another Claim button
                      then:
                        - click: "{{playoff_round_claim_button_coords}}" # click another Claim button
                        - delay: 1
                        - click: [60, 50] # exit from the playoff round reward screen
                      else:
                        - log: "Playoff round clain button is not available" 
                else:
                  - log: "Playoff round reward not available"
            
            - log : "Check if champion league final reward is available"
            - set:
                championship_reward_coords: "{{ get_coords_from_image('champion_cup_reward.png') }}"
            - if:
                condition: "championship_reward_coords" # Claim championship reward
                then:
                  - log: "Championship reward coordinates found"
                  - click: [ "{{ championship_reward_coords[0]}}", "{{ championship_reward_coords[1] }}" ] # Claim Championship reward
                  - delay: 3
                  - set:
                      claim_button_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}" 
                  - if:
                      condition: "claim_button_coords" # Claim another Claim button
                      then:
                        - click: "{{claim_button_coords}}" # click another Claim button
                        - delay: 1
                        - click: [60, 50] # exit from the playoff round reward screen
                      else:
                        - log: " clain button is not available" 
                else:
                  - log: "Champion league final reward is not available"
            
            - log : "Daily Sign In"
            - set:
                sign_in_coords: "{{ get_coords_from_image('sign_in.png') }}"
            - if:
                condition: "sign_in_coords" # Check if Sign-in button is available
                then:
                  - click: "{{sign_in_coords}}" # click sign in
                  - delay: 2
                  - set:
                      sign_in_claim_coords: "{{ get_coords_from_image('daily_reward_claim.png') }}"
                  - if:
                      condition: "sign_in_claim_coords" # Check if Claim button is available
                      then:
                        - click: "{{sign_in_claim_coords}}" # click Claim
                      else:
                        - log: "Sign-in claim button not found, returning to the guild screen"
                else:
                  - log: "Sign-in button has already been clicked"
            
            - log : "Go to Boss war screen"
            - set:
                boss_war_coords: "{{ get_coords_from_image('war_will_end.png') }}"
            - if:
                condition: "boss_war_coords" # Go to Boss war screen
                then:
                  - click: "{{boss_war_coords}}" # Go to Boss war screen
                  - delay: 2
                  - log: "Check if Challenge button available"
                  - set:
                      challenge_button_coords: "{{ get_coords_from_image('Challenge.png') }}" #TO-DO replace to a normal  war challenge button
                  - if:
                      condition: "challenge_button_coords" # Check if Challenge button available
                      then:
                        - click: "{{challenge_button_coords}}" # click Challenge button
                        - delay: 2
                        - set:
                            start_button_coords: "{{ get_coords_from_image('boss_war_start.png') }}"
                        - if:
                            condition: "start_button_coords" # Check if Start button is available
                            then:
                              - click: "{{start_button_coords}}" # click Start button
                              - delay: 5
                              - set:
                                  click_attempts: 0
                              - set:
                                  boss_war_reward_claim_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                              - while:
                                  condition: "not boss_war_reward_claim_coords and click_attempts < 10" 
                                  do:
                                    - log: "Claim button not visible. Attempt #{{ click_attempts + 1 }}"
                                    - set:
                                        end_boss_battle_button_coords: "{{ get_coords_from_image('end_boss_battle.png') }}"
                                    - if:
                                        condition: "end_boss_battle_button_coords"  # If End Boss Battle button is available
                                        then:
                                          - click: "{{end_boss_battle_button_coords}}" # click on fight finish button until Claim button appears
                                          - delay: 2
                                        else:
                                          - log: "WARNING: Neither 'Claim' nor 'End Battle' button is visible. Waiting..."
                                          - delay: 2
                                    - increment: click_attempts
                                    - set:
                                        boss_war_reward_claim_coords: "{{ get_coords_from_image('boss_war_reward_claim.png') }}"
                              
                              - if:
                                  condition: "boss_war_reward_claim_coords"
                                  then:
                                    - log: "Success! Claim button is now visible. Clicking it."
                                    - click: "{{ boss_war_reward_claim_coords }}"
                                    - set:
                                        confirm_button_coords: "{{ get_coords_from_image('confirm.png') }}"
                                    - click: "{{confirm_button_coords}}" # click Confirm button to finish the boss  battle
                                    - delay: 2
                                    - click: [60, 50] # unfocus from the ship
                                    - click: [60, 50] # return to the guild menu
                                  else:
                                    # This block runs if the loop finished because it hit 10 attempts.
                                    - log: "ERROR: Claim button did not appear after 10 attempts."
                                    - emergency_exit: "Boss War: Failed to find reward claim button after 10 attempts."
                            else:
                              - log: "Start  button not available, returning to the guild screen"
                              - click: [60, 50] # unfocus from the ship
                              - click: [60, 50] # unfocus from the ship
                              - click: [60, 50] # return to the guild menu
                      else:
                        - log: "Challenge button not available, returning to the guild screen"
                        - click: [60, 50] # unfocus from the ship
                        - click: [60, 50] # return to the guild menu  
                else:
                  - log: "Boss war screen not available"
                  
            - click: [60, 50] # return to the main game menu
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Guild_activity_new scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available        
  
  - name: Airship_farming
    description: Airship farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [996,352, left,400] # Scroll right to make sure Airship icon is visible
            - set:
                Airship_coords: "{{ get_coords_from_image('Airship.png') }}"
            - if:
                condition: "Airship_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Airship coordinates found"
                  - click: [ "{{ Airship_coords[0]}}", "{{ Airship_coords[1]-100 }}" ] # Click on the Airship icon
                  - delay: 2
                  - log : "Checking if Dragon_Crusade is on the screen"
                  - set:
                      Dragon_Crusade_coords: "{{ get_coords_from_image('Dragon_Crusade.png') }}"
                  - if:
                      condition: "Dragon_Crusade_coords"  # If Airship farming is available
                      then:
                        - log: "Dragon_Crusade_coords  coordinates found"
                        - click: [ "{{ Dragon_Crusade_coords[0]}}", "{{ Dragon_Crusade_coords[1]+200 }}" ] # Click on the Dragon_Crusade icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Dragon_Crusade icon is not available. I'm trying to click next one."
                        - click: [60, 50] # exit from the Airship reward screen
                  - set:
                      Steampunk_Relic_coords: "{{ get_coords_from_image('Steampunk_Relic.png') }}"
                  - if:
                      condition: "Steampunk_Relic_coords"  # If Steampunk_Relic_coords is available
                      then:
                        - log: "Steampunk_Relic_coords  coordinates found"
                        - click: [ "{{ Steampunk_Relic_coords[0]}}", "{{ Steampunk_Relic_coords[1]+200 }}" ] # Click on the Steampunk_Relic icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up 
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              # - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Steampunk_Relic icon is not available. I'm trying to click next one."
                        - click: [60, 50] # exit from the Airship reward screen
                  - set:
                      Mine_Exploration_coords: "{{ get_coords_from_image('Mine_Exploration.png') }}"
                  - if:
                      condition: "Mine_Exploration_coords"  # If Airship farming is available
                      then:
                        - log: "Mine_Exploration_coords  coordinates found"
                        - click: [ "{{ Mine_Exploration_coords[0]}}", "{{ Mine_Exploration_coords[1]+200 }}" ] # Click on the Mine_Exploration icon
                        - delay: 2
                        - scroll: [624,582, up,400] # Scroll up 
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - scroll: [624,582, up,400] # Scroll up
                        - set:
                            lowest_Sweep_coords: "{{ get_all_coords_from_image('Sweep.png') }}"
                        - if:
                            condition: "lowest_Sweep_coords" # True if the list is not empty
                            then:
                              # The list is sorted top-to-bottom, so the last item [-1] is the lowest on screen
                              # - log: "Found {{ len(lowest_Sweep_coords) }} buttons. Clicking the lowest one."
                              - click: "{{ lowest_Sweep_coords[-1] }}"
                              - delay: 4
                              - set:
                                  yellow_claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "yellow_claim_button_coords" # True if the list is not empty
                                  then:
                                    - log: "Found {{ len(yellow_claim_button_coords) }} yellow claim buttons. Clicking the  one."
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    #- click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                    - log: "click on Sweep button the second time"
                                    - click: "{{ lowest_Sweep_coords[-1] }}"
                                    - delay: 4
                                    - click: "{{ yellow_claim_button_coords}}" # Click on the yellow claim button
                                    - click: [60, 50] # exit from the Airship reward screen
                                    - delay: 1
                                  else:
                                    - log: "No yellow claim button found after Sweep"
                                    - click: [60, 50] # exit from the Airship reward screen
                            else:
                              - log: "No Sweep button found in Airship farming"
                              - click: [60, 50] # exit from the Airship reward screen
                      else:
                        - log: "Mine_Exploration icon is not available. Finishing Airship farming."
                        - click: [60, 50] # exit from the Airship reward screen
            
                  - log: "Try to exit from the Airship farming screen"
                  - click: [60, 50] # return to the main game screen
                  - set:
                      Mine_Exploration_coords: "{{ get_coords_from_image('Mine_Exploration.png') }}"
                  - log : "Checking if Mine_Exploration icon is available"
                  - if:
                      condition: "Mine_Exploration_coords"  # This is true if coordinates were found, false
                      then:                  
                        - log: "Mine_Exploration_coords icon is available, return to the main game screen"
                        - click: [60, 50] # return to the main game screen
                      else:
                        - log: "It seems we are in the main game screen already, no need to click"
                else:
                  - log: "Airship farming is not available, returning to the main game screen"
                  
            - log : "End of Airship farming"
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Airship_farming scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available

  - name: Dangeon_farming_new
    description: Dangeon farming
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [996,352, left,400] # Scroll left to make sure Dangeon icon is visible
            - set:
                Dangeon_coords: "{{ get_coords_from_image('dangeon.png') }}"
            - if:
                condition: "Dangeon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Dangeon coordinates found"
                  - click: [ "{{ Dangeon_coords[0]}}", "{{ Dangeon_coords[1]-150 }}" ] # Click on the Dangeon icon
                  - delay: 3
                  - log : "Checking if Sweep farming is available"
                  - set:
                      Sweep_button_coords: "{{ get_coords_from_image('Sweep_purple.png') }}"
                  - if:
                      condition: "Sweep_button_coords"  # If Dangeon farming is available
                      then:
                        - log: "Sweep_button_coords coordinates found"
                        - click: "{{ Sweep_button_coords }}" # Click on the Sweep button
                        - delay: 2
                        - set:
                            confirm_button_coords: "{{ get_coords_from_image('confirm_purple.png') }}"
                        - if:
                            condition: "confirm_button_coords"  # If Confirm button is available
                            then:
                              - log: "Confirm button coordinates found"
                              - click: "{{ confirm_button_coords }}" # Click on the Confirm button
                              - delay: 2
                              - set:
                                  claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                              - if:
                                  condition: "claim_button_coords"  # If Claim button is available
                                  then:
                                    - log: "Claim button coordinates found"
                                    - click: "{{ claim_button_coords }}" # Click on the Claim button
                                    - delay: 2
                                    - set:
                                        advanced_button_coords: "{{ get_coords_from_image('advanced.png') }}"
                                    - if:
                                        condition: "advanced_button_coords"  # If Confirm button is available
                                        then:
                                          - click: "{{ advanced_button_coords }}" # Click on the Confirm button
                                          - delay: 2
                                          - set:
                                              battle_red_coords: "{{ get_coords_from_image('battle_red.png') }}"
                                          - if:
                                              condition: "battle_red_coords"  # If Golden Chest button is available
                                              then:
                                                - log: "Battle Red button coordinates found"
                                                - click: [ "{{ battle_red_coords[0] + 865 }}", "{{ battle_red_coords[1]-15 }}" ] # Click on the Campaign icon
                                                - delay: 4
                                                - set:
                                                    claim_button_coords: "{{ get_coords_from_image('claim_yellow.png') }}"
                                                - if:
                                                    condition: "claim_button_coords"  # If Claim button is available
                                                    then:
                                                      - click: "{{ claim_button_coords }}" # Click on the Claim button
                                                      #- click: [60, 50] # exit from the Dangeon farming screen
                                                    else:
                                                      - log: "Claim button is not available in Dangeon farming"
                                                      #- click: [60, 50] # exit from the Dangeon farming screen
                                              else:
                                                - log: "Golden Chest button is not available in Dangeon farming"
                            else:
                              - log: "Confirm button is not available in Dangeon farming"
                      else:
                        - log: "Sweep button is not available"
                  - click: [60, 50] # return to the main game screen
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Airship_farming scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available      

  - name: Dangeon_farming
    description: Dangeon farming
    steps:
      #- scroll: [996,352, left,400] # Scroll left to make sure Dangeon icon is visible
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - scroll: [996,352, left,400] # Scroll left to make sure Dangeon icon is visible
            - click: [975,429] # enter to Dangeon
            - click: [926,674] # Click Sweep button
            - click: [765,465] # Click Confirm button
            - delay: 1
            - click: [638,587] # Click Claim button
            - click: [414,38] # Switch to Advanced Dangeon
            - click: [1198,659] # Initiate reward collection
            - delay: 3
            - if:
                condition: "compare_with_text_easyocr(588,459,104,45, 'Claim')" # Check if Claim button is available
                then:
                  - click: [638,481] # Click on Claim button
                else:
                  - log: "Claim button not found in Dangeon farming"
                  #- click: [60, 50] # return to the main  game screen
            - click: [60, 50] # exit main game screen
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Airship_farming scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available
  
  - name: Arena_farming
    description: Arena farming. Fight most left opponent in the list. Good for minor accounts.
    steps:
      - set:
          guild_coords: "{{ get_coords_from_image('Guild.png') }}"
      - if:
          condition: "guild_coords"  # This is true if coordinates were found, false
          then:
            - if:
                condition: "compare_with_text_easyocr(260,553,56,23,'Arena') or compare_with_any_image(260,553,56,23,'Arena.png',0.85)" #  Check if Arena icon is available
                then:
                  - click: [272,486] # Click on Arena icon
                  - delay: 1
                  ### General Arena ###
                  - click: [153,359] 
                  - delay: 3
                  - click: [629,560] # Click Match button
                  - delay: 1
                  # Quick battle checkbox is to be checked
                  # TO-DO Add a check if attack is free 
                  # Attack #1
                  - log: "General Arena attack #1"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - log: "General Arena attack #2"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - log: "General Arena attack #3"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - click: [60, 50] # exit General arena screen
                  - delay: 1
                  - click: [60, 50] # exit main arena screen

                  ### Cross server Arena ###
                  - log: "Cross server Arena farming"
                  - click: [474,377] 
                  - delay: 3
                  - click: [629,560] # Click Match button
                  - delay: 1
                  # Quick battle checkbox is to be checked
                  # Attack #1
                  - log: "Cross server Arena attack #1"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - log: "Cross server Arena attack #2"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - log: "Cross server Arena attack #3"
                  - click: [280,580] # Click the most left opponent in the list
                  - delay: 2
                  - click: [462,615] # Collect rewards
                  - delay: 2
                  - click: [462,615] # Second click if areana league is increased
                  - click: [60, 50] # exit General arena screen
                  - delay: 1
                  - click: [60, 50] # exit main arena screen
                  ### Summit Arena Challenge ###
                  # Placeholder for Summit Arena Challenge farming
                  
                  ### End farming ###
                  - log: "Arena farming completed"
                  - click: [60, 50] # exit main game screen
                else:
                  - log: "Arena icon is not available"
                  - send_email: "Arena farming failed for the {{ instance_name }} instance." # send an email if Arena icon is not available
          else:
            - log: "Guild icon is not available. I'm trying to restart the game."
            - set:
                game_icon_coords: "{{ get_coords_from_image('clone_evolution.png') }}"
            - if:
                condition: "game_icon_coords"  # This is true if coordinates were found, false
                then:
                  - log: "Game icon coordinates found, clicking on it to restart the game."
                  - click: "{{ game_icon_coords }}" # Click on the Game icon to restart the game
                  - delay: 150 # Wait for the game to restart
                  - log: "Arena_farming scenario is skipped due to game unavailability and restarted."
                else:
                  - log: "Game icon coordinates not found, cannot restart the game."
                  - send_email: "Guild icon is not available and game icon coordinates not found. Cannot restart the game." # send an email if Game icon is not available
      
  - name: Bonus_rewards
    description: Bonus rewards collection
    steps:
      - click: [70, 259] # Bonus icon
      - click: [90, 296] # Go to daily tasks

  - name: Supply_Depot
    description: Supply Depot farming
    steps:
      - if:
          condition: "compare_with_text_easyocr(142,301,111,26,'Supply')"
          then:
            - click: [194,263] # Enter to Supply Depot
            - if:
                condition: "compare_with_text_easyocr(882,637,215,37,'Free')" # If Free refresh button is available
                then:
                  - click: [968,656] # Click Free Refresh button
                  - if:
                      condition: "compare_with_any_image(427,207,105,105, ['purple.png', 'purple_chest.png'], 0.9)"  # Check item. Row 1 from 1. Column 1 from left 
                      then:
                        - click: [641,584] # Buy if resource is needed
                        - delay: 2
                        
                  
            
            - click: [60, 50] # return to the main  game sceen

