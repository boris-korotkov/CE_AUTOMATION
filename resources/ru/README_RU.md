# Фреймворк для автоматизации мобильных игр (Пример для Clone Evolution)

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

## Обзор

Этот проект представляет собой мощный и гибкий фреймворк для автоматизации повторяющихся задач в мобильных играх, запущенных на ПК через эмулятор Android. Используя компьютерное зрение и продуманный движок рабочих процессов, он может выполнять сложные, многошаговые действия, экономя ваше время и обеспечивая стабильное выполнение ежедневных рутин на нескольких игровых аккаунтах.

Хотя этот фреймворк можно адаптировать для любой мобильной игры, текущая реализация и рабочие процессы созданы специально для **Clone Evolution**.

### Преимущества автоматизации
*   **Экономия времени:** Автоматизируйте ежедневные задачи, сбор ресурсов и участие в событиях на всех ваших аккаунтах за минимальное время.
*   **Стабильность и точность:** Бот выполняет действия с пиксельной точностью, исключая человеческие ошибки.
*   **Управление несколькими аккаунтами:** Легко запускайте, выполняйте задачи и закрывайте несколько инстансов игры в заранее определенном порядке.
*   **Поддержка разных эмуляторов:** Фреймворк спроектирован для работы с различными эмуляторами. Хотя он в основном тестировался с **BlueStacks**, в него включены опции конфигурации для **Nox** и он может быть расширен.

## Ключевые особенности
*   **Компьютерное зрение на основе якорей:** Использует OpenCV для динамического поиска элементов интерфейса (кнопок, иконок и т.д.) на экране, что делает его устойчивым к рекламе, изменениям разрешения и небольшим сдвигам в интерфейсе.
*   **Продвинутое распознавание изображений:** Поддерживает как быстрое сопоставление по шаблону для статичных элементов, так и надежное сопоставление по признакам для анимированных или меняющихся элементов.
*   **Гибкий движок рабочих процессов:** Использует простые YAML-файлы для описания сложных, многошаговых сценариев с циклами, условной логикой и переменными.
*   **Централизованное управление сценариями:** Определяйте наборы сценариев один раз и применяйте их ко всем инстансам, что делает конфигурацию чистой и простой в управлении.
*   **Интерактивный скрипт-тестер:** Мощный инструмент командной строки (`ce_tester.py`) для отладки, поиска координат и тестирования распознавания изображений в реальном времени.
*   **Горячие клавиши и уведомления:** Поддерживает глобальные горячие клавиши для приостановки/возобновления или остановки скрипта, а также может отправлять уведомления по электронной почте о критических событиях.

## Демонстрационное видео

Посмотрите короткое видео, демонстрирующее, как бот выполняет ежедневные задачи на игровом инстансе.

➡️ **[Скачать демо-видео (fromsmash.com)](https://fromsmash.com/CE-Automation-demo)**

> [!NOTE]
> Срок действия этой ссылки истекает **4 августа 2025 года**. Если ссылка больше не работает, пожалуйста, создайте `issue` в этом репозитории, чтобы запросить обновленное видео.

## Технологический стек
*   **Язык:** Python 3
*   **Компьютерное зрение:** OpenCV, NumPy
*   **Распознавание текста (OCR):** Tesseract, EasyOCR
*   **Движок сценариев:** PyYAML, Jinja2
*   **Взаимодействие с эмулятором:** Android Debug Bridge (ADB)
*   **Зависимости:** scikit-learn, PyWin32, keyboard

---

## Начало работы

### Предварительные требования
Перед началом убедитесь, что у вас установлено и настроено следующее:

1.  **Python:** Версия 3.9 или выше.
2.  **Эмулятор Android:** Рекомендуется и протестирован **BlueStacks 5**.
3.  **Tesseract OCR:** Требуется для распознавания текста.
    *   Скачайте установщик из официального [репозитория Tesseract на GitHub](https://github.com/UB-Mannheim/tesseract/wiki).
    *   Во время установки **обязательно добавьте Tesseract в системную переменную PATH**. Это критически важный шаг.
    *   После установки обновите `tesseract_path` в файле `instances.ini`, указав путь к `tesseract.exe`.
4.  **Android Debug Bridge (ADB):** ADB необходим для связи с эмулятором. Обычно он поставляется вместе с BlueStacks. Убедитесь, что каталог, содержащий `HD-Adb.exe` (обычно в папке установки BlueStacks), добавлен в вашу системную переменную PATH.

### Установка
1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL-вашего-репозитория>
    cd <папка-вашего-репозитория>
    ```

2.  **Создайте и активируйте виртуальное окружение Python (рекомендуется):**
    ```bash
    # Создание окружения
    python -m venv venv

    # Активация (Windows)
    venv\Scripts\activate
    ```

3.  **Установите необходимые пакеты Python:**
    ```bash
    pip install -r requirements.txt
    ```

---

## Конфигурация
Вся конфигурация осуществляется в файле `instances.ini`. Это включает пути к эмуляторам, детали инстансов и сценарии для запуска.

**Подробное руководство по каждой настройке смотрите в [Руководстве по конфигурации](CONFIG_GUIDE_RU.md).**

---

## Использование

### Запуск основного бота (`ce_robot.py`)
Этот скрипт запускает полную последовательность автоматизации.

**1. Стандартный запуск:**
Использует разделы `[RunOrder]` и `[Workflows]` из `instances.ini`.
```bash
python ce_robot.py
```

**2. Запуск для конкретных инстансов:**
Игнорирует `[RunOrder]` и запускает только указанные инстансы.
```bash
python ce_robot.py Adidas CE_2024_1
```

**3. Запуск с пользовательским файлом сценариев:**
Использует указанный YAML-файл вместо стандартного. Идеально для тестирования или выполнения особых задач.
```bash
python ce_robot.py -wf "resources/en/special_tasks.yaml"
```

### Тестирование с помощью интерактивного тестера (`ce_tester.py`)
Этот скрипт предоставляет меню для тестирования отдельных действий без запуска полного сценария. Он необходим для создания новых сценариев автоматизации.

**Для запуска:**
```bash
# Убедитесь, что ваше виртуальное окружение активировано
python ce_tester.py <имя_инстанса>

# Пример:
python ce_tester.py Adidas
```
Вам будет предложено меню с опциями для поиска координат, тестирования распознавания изображений (как статичных, так и по признакам) и запуска отдельных сценариев.

---

## Создание сценариев
Логика автоматизации определяется в YAML-файлах (например, `resources/en/workflows.yaml`).

**Полный справочник по командам и руководство по написанию сценариев смотрите в [Руководстве пользователя](USER_MANUAL_RU.html).**

---

## Создание исполняемого файла (.exe)
Вы можете упаковать скрипт в один `.exe`-файл с помощью **PyInstaller**. Это позволяет запускать бота без необходимости установки Python.

1.  **Установите PyInstaller:**
    ```bash
    pip install pyinstaller
    ```

2.  **Выполните команду PyInstaller:**
    Эта команда упаковывает основной скрипт и корректно включает все необходимые файлы ресурсов и конфигурации. Запускайте ее из корневого каталога вашего проекта.
    ```bash
    pyinstaller --onefile --name "CE_Robot" ^
    --add-data "instances.ini;." ^
    --add-data "resources;resources" ^
    ce_robot.py
    ```
    *   `--onefile`: Упаковывает все в один исполняемый файл.
    *   `--add-data`: Это критически важно. Эта опция говорит PyInstaller включить в сборку ваши файлы конфигурации и ресурсов.
    *   Готовый `.exe`-файл будет находиться в папке `dist`.